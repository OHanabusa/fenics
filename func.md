# FEniCS における計算式と得られる形状

## **1. スカラー (`a`), ベクトル (`\vec{v}`), 行列 (`\boldsymbol{M}`) の定義**
- **スカラー**: $a, b, c$  （例: `Constant(1.0)`, `FunctionSpace` 内の `Function`）
- **ベクトル**: $\vec{v}, \vec{w}$  （例: `VectorFunctionSpace` の `Function`）
- **行列**: $\boldsymbol{M}, \boldsymbol{K}$  （例: `assemble()` で生成された `PETScMatrix`）

---

## **2. `dot()` と `inner()` の違い**
### **`dot(a, b)`**
`dot()` は **ベクトルやテンソルの要素ごとの積を計算** します。

| 計算式 | 数式表記 | 返り値の型 | 説明 |
|--------|--------|---------|------|
| `dot(v, w)` | $\vec{v} \cdot \vec{w}$ | **スカラー** | ベクトルの内積 |
| `dot(M, v)` | $\boldsymbol{M} \vec{v}$ | **ベクトル** | 行列とベクトルの積 |
| `dot(v, M)` | **未定義** | **エラー** | 行列は第1引数に取れない |
| `dot(M, N)` | **未定義** | **エラー** | 行列同士の積には `dot()` は使えない |
| `dot(a, v)` | $a \vec{v}$ | **ベクトル** | スカラーとベクトルの積 |
| `dot(a, M)` | $a \boldsymbol{M}$ | **行列** | スカラーと行列の積 |

✅ **`dot()` はベクトルや行列との積を計算できるが、行列同士には未定義。**  
❌ **`dot(v, M)` は使えず、`dot(M, v)` のみ可能。**

---

### **`inner(a, b)`**
`inner()` は **FEniCS の二重積分演算に使われ、ベクトル・行列の積にも適用できる。**

| 計算式 | 数式表記 | 返り値の型 | 説明 |
|--------|--------|---------|------|
| `inner(v, w)` | $\vec{v}^T \vec{w}$ | **スカラー** | ベクトルの内積（`dot(v, w)` と同じ） |
| `inner(M, v)` | $\boldsymbol{M} \vec{v}$ | **ベクトル** | 行列とベクトルの積（`dot(M, v)` と同じ） |
| `inner(v, M)` | $\vec{v}^T \boldsymbol{M}$ | **ベクトル** | ベクトルの転置と行列の積（`dot()` には無い機能） |
| `inner(M, N)` | $\text{tr}(\boldsymbol{M}^T \boldsymbol{N})$ | **スカラー** | 行列同士の Frobenius 内積 |
| `inner(a, v)` | $a \vec{v}$ | **ベクトル** | スカラーとベクトルの積（`dot(a, v)` と同じ） |
| `inner(a, M)` | $a \boldsymbol{M}$ | **行列** | スカラーと行列の積（`dot(a, M)` と同じ） |

✅ **`inner()` はベクトル・行列の両方に対して拡張可能**  
✅ **`inner(M, N)` で行列同士の積も計算できる（Frobenius 内積）**  
✅ **`inner(v, M)` でベクトルと行列の積が計算できる (`dot(v, M)` には未定義)**

---

## **3. 計算式と得られる形状**
### **一般的な計算式**
| **計算式** | **数式表現** | **得られる形状** | **説明** |
|------------|------------|--------------|--------------|
| `a * b` | $a \cdot b$ | **スカラー** | スカラー同士の積 |
| `a * v` | $a \vec{v}$ | **ベクトル** | スカラーとベクトルの積 |
| `a * M` | $a \boldsymbol{M}$ | **行列** | スカラーと行列の積 |
| `v + w` | $\vec{v} + \vec{w}$ | **ベクトル** | ベクトルの加算 |
| `v - w` | $\vec{v} - \vec{w}$ | **ベクトル** | ベクトルの減算 |
| `M * v` | $\boldsymbol{M} \vec{v}$ | **ベクトル** | 行列とベクトルの積 |
| `M * M` | $\boldsymbol{M} \boldsymbol{M}$ | **行列** | 行列同士の積 |
| `v^T * M` | $\vec{v}^T \boldsymbol{M}$ | **ベクトル** | ベクトルの転置と行列の積 |
| `v^T * w` | $\vec{v}^T \vec{w}$ | **スカラー** | ベクトルの転置とベクトルの積 |
| `\text{inv}(M)` | $\boldsymbol{M}^{-1}$ | **行列** | 行列の逆行列（`solve()` で解く） |
| `\text{tr}(M)` | $\text{tr}(\boldsymbol{M})$ | **スカラー** | 行列のトレース |
| `\text{det}(M)` | $\det(\boldsymbol{M})$ | **スカラー** | 行列の行列式 |
| `\text{norm}(v, "l2")` | $\|\vec{v}\|_2$ | **スカラー** | ベクトルの L2 ノルム |
| `\text{norm}(M, "frobenius")` | $\|\boldsymbol{M}\|_F$ | **スカラー** | 行列のフロベニウスノルム |

---

# FEniCS におけるベクトルの要素ごとの積（Hadamard 積）

## **1. 要素ごとの積とは？**
FEniCS では、**ベクトル同士の要素ごとの積（Hadamard 積）を計算する標準の関数は提供されていません。**  
しかし、NumPy を利用することで、各成分ごとの積を計算し、FEniCS の `Function` に戻すことが可能です。

---

## **2. 数式表記**
要素ごとの積（Hadamard 積）は次のように表されます：

$$
\vec{v} \circ \vec{w} = \begin{bmatrix} v_1 w_1 \\ v_2 w_2 \\ \vdots \\ v_n w_n \end{bmatrix}
$$


ここで、**各成分が対応する位置のベクトル要素の積** になっています。
```
 v.vector().get_local() * w.vector().get_local()
```
--

## **4. まとめ**
| **計算式** | **`dot()`** | **`inner()`** | **返り値の型** |
|------------|------------|------------|------------|
| `dot(v, w)` | ✅ | ✅ | スカラー |
| `dot(M, v)` | ✅ | ✅ | ベクトル |
| `dot(v, M)` | ❌ | ✅ | ベクトル |
| `dot(M, M)` | ❌ | ✅ | スカラー（Frobenius 内積） |

✅ **ベクトルの内積 (`dot(v, w)`) は `inner(v, w)` と同じ。**  
✅ **`inner()` は行列にも使えるが、`dot()` は未定義のケースが多い。**  
✅ **`inner(M, M)` は Frobenius 内積を計算できる（`dot(M, M)` はエラー）。**  

---
